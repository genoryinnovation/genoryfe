import{d as L,r as x,f as M,x as I,c as m,a as e,b as h,t as a,o as y,s as T,h as N,F as C,l as D,e as $,p as G,g as R,k as A,q as F,u as j}from"./index-C4KQTk6n.js";import{O as k}from"./order.service-DFbBhsZg.js";import"./api-Csnh6SWI.js";function B(r,o){r.src=o}const V=r=>{var o,l,s,d="The Google Maps JavaScript API",c="google",g="importLibrary",_="__ib__",n=document,t=window,p=t[c]||(t[c]={}),i=p.maps||(p.maps={}),b=new Set,v=new URLSearchParams,u=()=>o||(o=new Promise(async(f,w)=>{var O;await(l=n.createElement("script")),v.set("libraries",[...b]+"");for(s in r)v.set(s.replace(/[A-Z]/g,P=>"_"+P[0].toLowerCase()),r[s]);v.set("callback",c+".maps."+_),B(l,"https://maps.googleapis.com/maps/api/js?"+v),i[_]=f,l.onerror=()=>o=w(Error(d+" could not load.")),l.nonce=((O=n.querySelector("script[nonce]"))==null?void 0:O.nonce)||"",n.head.append(l)}));i[g]?console.warn(d+" only loads once. Ignoring:",r):i[g]=(f,...w)=>b.add(f)&&u().then(()=>i[g](f,...w))},U=r=>`The setOptions() function should only be called once. The options passed to the additional call (${JSON.stringify(r)}) will be ignored.`,z=r=>`The google.maps.importLibrary() function is already defined, and @googlemaps/js-api-loader will use the existing function instead of overwriting it. The options passed to setOptions (${JSON.stringify(r)}) will be ignored.`,J=()=>{},K=()=>{};let E=!1;function q(r){if(E){J(U(r));return}W(r),E=!0}async function S(r){var o,l;if(!((l=(o=window==null?void 0:window.google)==null?void 0:o.maps)!=null&&l.importLibrary))throw new Error("google.maps.importLibrary is not installed.");return await google.maps.importLibrary(r)}function W(r){var l,s;const o=!!((s=(l=window.google)==null?void 0:l.maps)!=null&&s.importLibrary);o&&K(z(r)),o||V(r)}const Y={class:"w-full h-96 bg-gray-100 rounded-lg overflow-hidden relative"},Z={key:0,class:"absolute inset-0 flex items-center justify-center bg-gray-100 bg-opacity-75 z-10"},X={key:1,class:"absolute inset-0 flex items-center justify-center bg-gray-100 z-10"},H={class:"text-red-600"},Q="AIzaSyBkZraD0rt4dP0TslLVMexomnye48jFcW0",ee=L({__name:"OrderTrackingMap",props:{deliveryAddress:{},orderStatus:{}},setup(r){const o=r,l=x(null),s=x(!0),d=x(null);let c=null,g=null;const _=async()=>{if(l.value){s.value=!0,d.value=null;try{q({key:Q,v:"weekly",libraries:["places"]});const{Map:t}=await S("maps"),{Marker:p}=await S("marker"),i={lat:6.5244,lng:3.3792};c=new t(l.value,{center:i,zoom:12,mapId:"DEMO_MAP_ID"}),o.deliveryAddress?await n(c,p):s.value=!1}catch(t){console.error("Error loading Google Maps:",t),d.value="Failed to load map.",s.value=!1}}},n=async(t,p)=>{if(!o.deliveryAddress)return;let i=null;if(o.deliveryAddress.latitude&&o.deliveryAddress.longitude)i={lat:o.deliveryAddress.latitude,lng:o.deliveryAddress.longitude};else{const b=`${o.deliveryAddress.street}, ${o.deliveryAddress.city}, ${o.deliveryAddress.state}, ${o.deliveryAddress.country}`;try{const{Geocoder:v}=await S("geocoding"),f=await new v().geocode({address:b});f.results&&f.results.length>0?i=f.results[0].geometry.location.toJSON():d.value="Could not find location for this address."}catch(v){console.error("Geocoding error:",v),d.value="Error finding location."}}i&&(t.setCenter(i),t.setZoom(15),g&&g.setMap(null),g=new p({position:i,map:t,title:"Delivery Location",animation:google.maps.Animation.DROP})),s.value=!1};return M(()=>{_()}),I(()=>o.deliveryAddress,()=>{c&&_()},{deep:!0}),(t,p)=>(y(),m("div",Y,[e("div",{ref_key:"mapContainer",ref:l,class:"w-full h-full"},null,512),s.value?(y(),m("div",Z,[...p[0]||(p[0]=[e("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1)])])):h("",!0),d.value?(y(),m("div",X,[e("p",H,a(d.value),1)])):h("",!0)]))}}),te={key:0},se={class:"flex justify-between items-center mb-6"},oe={class:"text-2xl font-semibold text-gray-900"},re={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},ae={class:"lg:col-span-2 space-y-6"},le={key:0,class:"bg-white shadow rounded-lg overflow-hidden"},ie={class:"p-4"},de={class:"bg-white shadow rounded-lg overflow-hidden"},ne={class:"divide-y divide-gray-200"},ue=["src"],ce={class:"ml-4 flex-1"},pe={class:"text-sm font-medium text-gray-900"},ve={class:"text-sm text-gray-500"},ge={class:"text-right"},me={class:"text-sm font-medium text-gray-900"},ye={class:"text-sm text-gray-500"},fe={class:"bg-gray-50 px-4 py-4 sm:px-6 flex justify-between items-center border-t border-gray-200"},_e={class:"text-lg font-bold text-gray-900"},be={class:"space-y-6"},xe={class:"bg-white shadow rounded-lg p-6"},he={class:"space-y-4"},we=["disabled"],Ae={class:"bg-white shadow rounded-lg p-6"},Se={class:"text-sm text-gray-600 space-y-2"},Oe={key:0,class:"bg-white shadow rounded-lg p-6"},ke={class:"text-sm text-gray-600"},Ee={key:1,class:"text-center py-12"},Ie=L({__name:"[id]",setup(r){const o=F(),l=j(),s=x(null),d=x(""),c=x(!1),g=async()=>{try{const n=await k.getOrder(o.params.id);s.value=n.data,d.value=n.data.orderStatus}catch(n){console.error("Failed to fetch order",n)}},_=async()=>{if(s.value){c.value=!0;try{await k.updateOrderStatus(s.value._id,d.value),await g(),alert("Order status updated")}catch(n){console.error("Failed to update status",n),alert("Failed to update status")}finally{c.value=!1}}};return M(()=>{g()}),(n,t)=>{var p,i,b,v;return s.value?(y(),m("div",te,[e("div",se,[e("h1",oe," Order #"+a(s.value.orderNumber),1),e("button",{onClick:t[0]||(t[0]=u=>T(l).back()),class:"text-gray-600 hover:text-gray-900"}," Back to Orders ")]),e("div",re,[e("div",ae,[s.value.deliveryAddress?(y(),m("div",le,[t[2]||(t[2]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Delivery Location")],-1)),e("div",ie,[N(ee,{deliveryAddress:s.value.deliveryAddress,orderStatus:s.value.orderStatus},null,8,["deliveryAddress","orderStatus"])])])):h("",!0),e("div",de,[t[4]||(t[4]=e("div",{class:"px-4 py-5 sm:px-6 border-b border-gray-200"},[e("h3",{class:"text-lg leading-6 font-medium text-gray-900"},"Items")],-1)),e("ul",ne,[(y(!0),m(C,null,D(s.value.items,u=>(y(),m("li",{key:u.product._id,class:"p-4 flex items-center"},[e("img",{src:u.product.images[0]||"https://via.placeholder.com/60",class:"h-16 w-16 object-cover rounded"},null,8,ue),e("div",ce,[e("div",pe,a(u.product.title),1),e("div",ve,"SKU: "+a(u.product.sku),1)]),e("div",ge,[e("div",me,a(s.value.currency)+" "+a(u.price.toFixed(2))+" x "+a(u.quantity),1),e("div",ye,a(s.value.currency)+" "+a(u.lineTotal.toFixed(2)),1)])]))),128))]),e("div",fe,[t[3]||(t[3]=e("span",{class:"text-base font-medium text-gray-900"},"Total",-1)),e("span",_e,a(s.value.currency)+" "+a(s.value.totalAmount.toFixed(2)),1)])])]),e("div",be,[e("div",xe,[t[7]||(t[7]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Status",-1)),e("div",he,[e("div",null,[t[6]||(t[6]=e("label",{class:"block text-sm font-medium text-gray-700"},"Order Status",-1)),$(e("select",{"onUpdate:modelValue":t[1]||(t[1]=u=>d.value=u),class:"mt-1 block w-full border border-gray-300 rounded-md shadow-sm p-2"},[...t[5]||(t[5]=[R('<option value="pending">Pending</option><option value="confirmed">Confirmed</option><option value="processing">Processing</option><option value="shipped">Shipped</option><option value="delivered">Delivered</option><option value="cancelled">Cancelled</option>',6)])],512),[[G,d.value]])]),e("button",{onClick:_,disabled:c.value,class:"w-full inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50"},a(c.value?"Updating...":"Update Status"),9,we)])]),e("div",Ae,[t[11]||(t[11]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Customer",-1)),e("div",Se,[e("p",null,[t[8]||(t[8]=e("span",{class:"font-medium text-gray-900"},"Name:",-1)),A(" "+a((p=s.value.userId)==null?void 0:p.firstName)+" "+a((i=s.value.userId)==null?void 0:i.lastName),1)]),e("p",null,[t[9]||(t[9]=e("span",{class:"font-medium text-gray-900"},"Email:",-1)),A(" "+a((b=s.value.userId)==null?void 0:b.email),1)]),e("p",null,[t[10]||(t[10]=e("span",{class:"font-medium text-gray-900"},"Phone:",-1)),A(" "+a(((v=s.value.userId)==null?void 0:v.phone)||"N/A"),1)])])]),s.value.deliveryAddress?(y(),m("div",Oe,[t[12]||(t[12]=e("h3",{class:"text-lg font-medium text-gray-900 mb-4"},"Delivery Address",-1)),e("div",ke,[e("p",null,a(s.value.deliveryAddress.street),1),e("p",null,a(s.value.deliveryAddress.city)+", "+a(s.value.deliveryAddress.state),1),e("p",null,a(s.value.deliveryAddress.country),1)])])):h("",!0)])])])):(y(),m("div",Ee,[...t[13]||(t[13]=[e("p",{class:"text-gray-500"},"Loading order details...",-1)])]))}}});export{Ie as default};
