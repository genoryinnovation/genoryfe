import{d as Z,r as i,o as ee,i as te,a as l,j as o,b as e,e as p,p as f,z as b,t as a,F as D,f as q,h as R,w as Q,n as H,q as C,E as se,C as W}from"./index-C8zvf3I_.js";import{P}from"./partner-portal.service-D36OMrJc.js";import"./api-4GkiaaGr.js";const le={class:"space-y-6"},oe={class:"flex justify-between items-center"},ae={class:"flex space-x-3"},re={class:"relative"},ie={class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ne={class:"bg-white p-6 rounded-xl shadow-sm border border-slate-200"},de={class:"text-3xl font-bold text-slate-900 mt-2"},ue={class:"bg-white p-6 rounded-xl shadow-sm border border-slate-200"},pe={class:"text-3xl font-bold text-slate-900 mt-2"},me={class:"bg-white p-6 rounded-xl shadow-sm border border-slate-200"},ce={class:"text-3xl font-bold text-primary-600 mt-2"},xe={class:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden relative"},ve={key:0,class:"absolute inset-0 bg-white/50 backdrop-blur-[2px] flex items-center justify-center z-10"},fe={class:"w-full text-left border-collapse"},be={class:"divide-y divide-slate-200"},ye={key:0},he={class:"px-6 py-4"},ge={class:"w-10 h-10 rounded-xl bg-primary-50 flex items-center justify-center text-primary-600 font-black text-sm uppercase shadow-sm"},we={class:"flex flex-col"},ke={class:"font-bold text-slate-900 leading-tight"},_e={key:0,class:"text-[10px] text-slate-400 font-black uppercase tracking-widest mt-0.5"},Ce={class:"px-6 py-4 text-slate-600 font-medium"},Ne={class:"px-6 py-4"},Ee={class:"px-6 py-4"},Ie={class:"text-sm font-black text-slate-900 tabular-nums italic"},Se={class:"px-6 py-4"},Me={key:1,class:"px-6 py-4 bg-slate-50 border-t border-slate-200 flex items-center justify-between font-bold"},Ve={class:"text-sm text-slate-500"},Te={class:"text-slate-900"},je={class:"text-slate-900"},Be={class:"text-slate-900"},Ue={class:"flex space-x-2"},ze=["disabled"],Fe={class:"flex space-x-1"},Pe=["onClick"],Ae=["disabled"],$e={key:0,class:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},Le={class:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden"},De={class:"p-6 border-b border-slate-100 flex justify-between items-center"},qe={key:0,class:"p-3 bg-rose-50 border border-rose-100 rounded-xl text-rose-600 text-sm font-medium animate-in fade-in slide-in-from-top-1"},He={key:1,class:"p-3 bg-emerald-50 border border-emerald-100 rounded-xl text-emerald-600 text-sm font-medium animate-in fade-in slide-in-from-top-1"},Oe={class:"grid grid-cols-2 gap-4"},Re={class:"space-y-1"},Qe={class:"space-y-1"},We={class:"space-y-1"},Ge={class:"space-y-1"},Je={class:"space-y-1"},Ke={class:"pt-4"},Xe=["disabled"],Ye={key:0},Ze={key:1,class:"animate-spin h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24"},et={key:1,class:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},tt={class:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden animate-in zoom-in duration-200"},st={class:"p-6 border-b border-slate-100 flex justify-between items-center"},lt={class:"p-6 space-y-6"},ot={key:0,class:"p-3 bg-rose-50 border border-rose-100 rounded-xl text-rose-600 text-sm font-medium animate-in fade-in slide-in-from-top-1"},at={class:"bg-slate-50 p-4 rounded-xl border border-dashed border-slate-300 text-center relative"},rt={class:"text-sm font-bold text-slate-700"},it={class:"text-xs mt-1"},nt={key:0,class:"mt-2 text-[10px] space-y-0.5"},dt={class:"flex space-x-3"},ut=["disabled"],pt={key:0},mt={key:1,class:"animate-spin h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24"},ct=Z({__name:"index",setup(xt){const N=i([]),E=i(null),I=i(!0),S=i(!1),M=i(!1),V=i(!1),x=i(null),O=i(null),m=i(null),c=i(""),y=i(""),T=i(!1),A=i(""),r=i(null),$=i(null),d=i({email:"",firstName:"",lastName:"",hrEmployeeId:"",orderThreshold:2e4}),h=async(n=1)=>{try{I.value=!0;const[t,u]=await Promise.all([P.getEmployees({page:n,limit:10,search:A.value}),P.getStats()]);N.value=t.data,r.value=t.meta,E.value=u}catch(t){console.error("Failed to fetch employees",t)}finally{I.value=!1}},G=()=>{$.value&&clearTimeout($.value),$.value=setTimeout(()=>{h(1)},500)},L=n=>{h(n)},J=async()=>{var n,t;try{c.value="",y.value="",T.value=!0,await P.inviteEmployee(d.value),y.value="Employee invited successfully!",await h(),setTimeout(()=>{M.value=!1,y.value="",d.value={email:"",firstName:"",lastName:"",hrEmployeeId:"",orderThreshold:2e4}},1500)}catch(u){console.error("Failed to invite employee",u),c.value=((t=(n=u.response)==null?void 0:n.data)==null?void 0:t.message)||"Failed to invite employee. Please check your data."}finally{T.value=!1}},K=n=>{x.value=n.target.files[0],m.value=null},X=async()=>{var n,t;if(x.value)try{c.value="",S.value=!0;const g=(await x.value.text()).split(`
`).filter(s=>s.trim()),j=g[0].toLowerCase().includes("email")?1:0,w=g.slice(j).map(s=>{const[v,B,U,z,_]=s.split(",").map(F=>F.trim());return{email:v,firstName:B,lastName:U,hrEmployeeId:z,orderThreshold:_?parseInt(_):2e4}}).filter(s=>s.email&&s.firstName);if(w.length===0)throw new Error("No valid employee data found in CSV.");const k=await P.bulkInviteEmployees(w);m.value=k,k.successful>0&&await h(),x.value=null}catch(u){console.error("Failed bulk upload",u),c.value=((t=(n=u.response)==null?void 0:n.data)==null?void 0:t.message)||u.message||"Failed to process CSV file."}finally{S.value=!1}},Y=()=>{var n;(n=O.value)==null||n.click()};return ee(h),(n,t)=>{var g,j,w,k;const u=te("router-link");return o(),l("div",le,[e("div",oe,[t[14]||(t[14]=e("div",null,[e("h1",{class:"text-2xl font-bold text-slate-900"},"Employee Management"),e("p",{class:"text-slate-500"},"Manage your employees and their spending limits.")],-1)),e("div",ae,[e("div",re,[f(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>A.value=s),onInput:G,type:"text",placeholder:"Search employees...",class:"pl-10 pr-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none w-64 transition-all"},null,544),[[b,A.value]]),t[13]||(t[13]=e("svg",{class:"w-5 h-5 text-slate-400 absolute left-3 top-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),e("button",{onClick:t[1]||(t[1]=s=>V.value=!0),class:"px-4 py-2 text-primary-600 bg-primary-50 rounded-lg hover:bg-primary-100 transition-colors"}," Bulk Upload "),e("button",{onClick:t[2]||(t[2]=s=>M.value=!0),class:"px-4 py-2 text-white bg-primary-600 rounded-lg hover:bg-primary-700 transition-colors"}," Add Employee ")])]),e("div",ie,[e("div",ne,[t[15]||(t[15]=e("p",{class:"text-sm font-medium text-slate-500"},"Total Employees",-1)),e("p",de,a(((g=E.value)==null?void 0:g.employeeCount)||N.value.length),1)]),e("div",ue,[t[16]||(t[16]=e("p",{class:"text-sm font-medium text-slate-500"},"Pending Approvals",-1)),e("p",pe,a(((j=E.value)==null?void 0:j.pendingOrders)||0),1)]),e("div",me,[t[17]||(t[17]=e("p",{class:"text-sm font-medium text-slate-500"},"This Month's Spending",-1)),e("p",ce,"₦"+a(((k=(w=E.value)==null?void 0:w.monthSpend)==null?void 0:k.toLocaleString())||0),1)])]),e("div",xe,[I.value?(o(),l("div",ve,[...t[18]||(t[18]=[e("svg",{class:"animate-spin h-8 w-8 text-primary-600",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):p("",!0),e("table",fe,[t[22]||(t[22]=e("thead",{class:"bg-slate-50 border-b border-slate-200"},[e("tr",null,[e("th",{class:"px-6 py-4 text-sm font-semibold text-slate-600"},"Employee"),e("th",{class:"px-6 py-4 text-sm font-semibold text-slate-600"},"Email"),e("th",{class:"px-6 py-4 text-sm font-semibold text-slate-600"},"Status"),e("th",{class:"px-6 py-4 text-sm font-semibold text-slate-600"},"Threshold"),e("th",{class:"px-6 py-4 text-sm font-semibold text-slate-600"},"Actions")])],-1)),e("tbody",be,[N.value.length===0&&!I.value?(o(),l("tr",ye,[...t[19]||(t[19]=[e("td",{colspan:"5",class:"px-6 py-12 text-center text-slate-500"}," No employees found. Invite your first employee to get started. ",-1)])])):p("",!0),(o(!0),l(D,null,q(N.value,s=>{var v,B,U,z,_;return o(),l("tr",{key:s.email,class:"hover:bg-slate-50 transition-colors"},[e("td",he,[R(u,{to:`/partner/employees/${s._id}`,class:"flex items-center space-x-3 hover:opacity-80 transition-opacity"},{default:Q(()=>{var F;return[e("div",ge,a(s.firstName.charAt(0)),1),e("div",we,[e("span",ke,a(s.firstName)+" "+a(s.lastName),1),(F=s.membership)!=null&&F.employeeId?(o(),l("span",_e,"ID: "+a(s.membership.employeeId),1)):p("",!0)])]}),_:2},1032,["to"])]),e("td",Ce,a(s.email),1),e("td",Ne,[e("span",{class:H(["inline-flex items-center px-3 py-1 rounded-lg text-[10px] font-black uppercase tracking-widest italic",((v=s.membership)==null?void 0:v.status)==="active"?"bg-emerald-50 text-emerald-600":"bg-rose-50 text-rose-600"])},a(((B=s.membership)==null?void 0:B.status)||"Unknown"),3)]),e("td",Ee,[e("p",Ie," ₦"+a(((_=(z=(U=s.membership)==null?void 0:U.settings)==null?void 0:z.orderThreshold)==null?void 0:_.toLocaleString())||"0"),1),t[20]||(t[20]=e("p",{class:"text-[9px] text-slate-400 font-bold uppercase tracking-tighter mt-0.5"},"Per Order Limit",-1))]),e("td",Se,[R(u,{to:`/partner/employees/${s._id}`,class:"text-blue-600 hover:text-blue-800 font-medium"},{default:Q(()=>[...t[21]||(t[21]=[C(" View Stats ",-1)])]),_:1},8,["to"])])])}),128))])]),r.value&&r.value.pages>1?(o(),l("div",Me,[e("span",Ve,[t[23]||(t[23]=C(" Showing ",-1)),e("span",Te,a(r.value.page*r.value.limit-r.value.limit+1),1),t[24]||(t[24]=C(" to ",-1)),e("span",je,a(Math.min(r.value.page*r.value.limit,r.value.total)),1),t[25]||(t[25]=C(" of ",-1)),e("span",Be,a(r.value.total),1),t[26]||(t[26]=C(" entries ",-1))]),e("div",Ue,[e("button",{onClick:t[3]||(t[3]=s=>L(r.value.page-1)),disabled:!r.value.hasPrevPage,class:"px-3 py-1 border border-slate-200 rounded-lg bg-white hover:bg-slate-50 disabled:opacity-50 transition-colors"}," Prev ",8,ze),e("div",Fe,[(o(!0),l(D,null,q(r.value.pages,s=>(o(),l("button",{key:s,onClick:v=>L(s),class:H(["px-3 py-1 border rounded-lg transition-colors",r.value.page===s?"bg-primary-600 text-white border-primary-600":"bg-white border-slate-200 hover:bg-slate-50"])},a(s),11,Pe))),128))]),e("button",{onClick:t[4]||(t[4]=s=>L(r.value.page+1)),disabled:!r.value.hasNextPage,class:"px-3 py-1 border border-slate-200 rounded-lg bg-white hover:bg-slate-50 disabled:opacity-50 transition-colors"}," Next ",8,Ae)])])):p("",!0)]),M.value?(o(),l("div",$e,[e("div",Le,[e("div",De,[t[28]||(t[28]=e("h3",{class:"text-xl font-bold text-slate-900"},"Invite Employee",-1)),e("button",{onClick:t[5]||(t[5]=s=>M.value=!1),class:"text-slate-400 hover:text-slate-600"},[...t[27]||(t[27]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("form",{onSubmit:se(J,["prevent"]),class:"p-6 space-y-4"},[c.value?(o(),l("div",qe,a(c.value),1)):p("",!0),y.value?(o(),l("div",He,a(y.value),1)):p("",!0),e("div",Oe,[e("div",Re,[t[29]||(t[29]=e("label",{class:"text-sm font-medium text-slate-700"},"First Name",-1)),f(e("input",{"onUpdate:modelValue":t[6]||(t[6]=s=>d.value.firstName=s),type:"text",required:"",class:"w-full px-4 py-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 outline-none"},null,512),[[b,d.value.firstName]])]),e("div",Qe,[t[30]||(t[30]=e("label",{class:"text-sm font-medium text-slate-700"},"Last Name",-1)),f(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>d.value.lastName=s),type:"text",required:"",class:"w-full px-4 py-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 outline-none"},null,512),[[b,d.value.lastName]])])]),e("div",We,[t[31]||(t[31]=e("label",{class:"text-sm font-medium text-slate-700"},"Email Address",-1)),f(e("input",{"onUpdate:modelValue":t[8]||(t[8]=s=>d.value.email=s),type:"email",required:"",class:"w-full px-4 py-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 outline-none"},null,512),[[b,d.value.email]])]),e("div",Ge,[t[32]||(t[32]=e("label",{class:"text-sm font-medium text-slate-700"},"Staff ID (Optional)",-1)),f(e("input",{"onUpdate:modelValue":t[9]||(t[9]=s=>d.value.hrEmployeeId=s),type:"text",class:"w-full px-4 py-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 outline-none"},null,512),[[b,d.value.hrEmployeeId]])]),e("div",Je,[t[33]||(t[33]=e("label",{class:"text-sm font-medium text-slate-700"},"Weekly Threshold (₦)",-1)),f(e("input",{"onUpdate:modelValue":t[10]||(t[10]=s=>d.value.orderThreshold=s),type:"number",class:"w-full px-4 py-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 outline-none"},null,512),[[b,d.value.orderThreshold]])]),e("div",Ke,[e("button",{type:"submit",disabled:T.value,class:"w-full py-3 bg-primary-600 text-white font-bold rounded-xl hover:bg-primary-700 transition-all disabled:opacity-50 flex items-center justify-center space-x-2"},[T.value?(o(),l("svg",Ze,[...t[34]||(t[34]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(o(),l("span",Ye,"Send Invitation"))],8,Xe)])],32)])])):p("",!0),V.value?(o(),l("div",et,[e("div",tt,[e("div",st,[t[36]||(t[36]=e("div",null,[e("h3",{class:"text-xl font-bold text-slate-900"},"Bulk Employee Upload"),e("p",{class:"text-slate-500 text-xs mt-1"},"Upload a CSV file with employee details.")],-1)),e("button",{onClick:t[11]||(t[11]=s=>V.value=!1),class:"text-slate-400 hover:text-slate-600"},[...t[35]||(t[35]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)])])]),e("div",lt,[c.value?(o(),l("div",ot,a(c.value),1)):p("",!0),e("div",at,[t[38]||(t[38]=e("p",{class:"text-xs text-slate-500 mb-4 italic"}," Format: email, firstName, lastName, [staffId], [threshold] ",-1)),e("input",{type:"file",accept:".csv",onChange:K,class:"hidden",ref_key:"fileInput",ref:O},null,544),e("button",{onClick:Y,class:"w-full py-6 flex flex-col items-center justify-center space-y-2 hover:bg-white transition-all rounded-lg"},[t[37]||(t[37]=e("svg",{class:"w-8 h-8 text-primary-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})],-1)),e("span",rt,a(x.value?x.value.name:"Click to select CSV file"),1)])]),m.value?(o(),l("div",{key:1,class:H(["p-4 rounded-xl",m.value.failed>0?"bg-amber-50 text-amber-800":"bg-emerald-50 text-emerald-800"])},[t[39]||(t[39]=e("p",{class:"text-sm font-bold"},"Upload Complete",-1)),e("p",it,"Successful: "+a(m.value.successful)+" | Failed: "+a(m.value.failed),1),m.value.errors.length>0?(o(),l("div",nt,[(o(!0),l(D,null,q(m.value.errors.slice(0,3),(s,v)=>(o(),l("p",{key:v}," • "+a(s.email)+": "+a(s.error),1))),128))])):p("",!0)],2)):p("",!0),e("div",dt,[e("button",{onClick:t[12]||(t[12]=s=>V.value=!1),class:"flex-1 py-3 border border-slate-200 text-slate-600 font-bold rounded-xl hover:bg-slate-50"}," Cancel "),e("button",{onClick:X,disabled:!x.value||S.value,class:"flex-1 py-3 bg-primary-600 text-white font-bold rounded-xl hover:bg-primary-700 transition-all disabled:opacity-50 flex items-center justify-center"},[S.value?(o(),l("svg",mt,[...t[40]||(t[40]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):(o(),l("span",pt,"Upload Employees"))],8,ut)])])])])):p("",!0)])}}});typeof W=="function"&&W(ct);export{ct as default};
