import{d as $,k as W,r as d,o as I,a as n,j as r,b as e,e as m,t as a,q as f,n as x,g as j,p as S,z as B,A as E,F as A,f as F,C as N}from"./index-DPa4r9b9.js";import{P as y}from"./partner-portal.service-D36OMrJc.js";import"./api-4GkiaaGr.js";const G={class:"space-y-6"},K={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},O={class:"text-2xl font-bold text-slate-900"},Q={class:"mt-1 text-sm text-slate-500"},J={class:"flex items-center space-x-3"},X={class:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4"},Y={class:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-shadow group"},Z={class:"flex items-center justify-between mb-4"},ee={class:"text-sm font-medium text-slate-500"},te={class:"text-2xl font-bold text-slate-900"},se={key:1,class:"mt-2 text-xs font-medium text-slate-400"},ae={class:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-shadow"},oe={class:"text-2xl font-bold text-slate-900"},le={class:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-shadow"},ne={class:"flex items-center justify-between mb-4"},re={class:"text-sm font-medium text-slate-500"},ie={class:"text-2xl font-bold text-slate-900"},de={class:"mt-2 text-xs text-slate-400 font-medium"},ce={class:"bg-white p-6 rounded-2xl shadow-sm border border-slate-100 hover:shadow-md transition-shadow"},pe={class:"text-2xl font-bold text-slate-900"},ue={class:"mt-2 text-xs text-slate-400 font-medium"},me={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 py-2"},xe={class:"relative flex-1 max-w-md"},ve={class:"flex items-center space-x-3"},fe={class:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden"},ye={class:"overflow-x-auto text-sm"},be={class:"min-w-full divide-y divide-slate-200"},he={class:"divide-y divide-slate-100"},ge={key:1},we={class:"px-6 py-4 whitespace-nowrap font-medium text-slate-900"},ke={class:"px-6 py-4"},_e={class:"text-slate-900 font-semibold mb-0.5"},Ce={class:"text-[11px] text-slate-400 truncate max-w-[200px]"},Te={class:"px-6 py-4 whitespace-nowrap"},je={class:"px-6 py-4 whitespace-nowrap"},Se={class:"px-6 py-4 whitespace-nowrap"},Me={class:"px-6 py-4 whitespace-nowrap text-xs text-slate-500 tabular-nums"},qe={class:"px-6 py-4 whitespace-nowrap text-right text-xs font-medium"},Pe=["onClick","disabled"],Ve={key:0,class:"animate-spin h-3 w-3 mr-1",fill:"none",viewBox:"0 0 24 24"},De={key:1,class:"text-slate-300"},ze={key:0,class:"px-6 py-4 bg-slate-50 border-t border-slate-100 flex items-center justify-between"},Be={class:"text-xs text-slate-500"},Ae={class:"flex space-x-2"},Fe=["disabled"],Ne=["disabled"],Re={key:0,class:"fixed inset-0 z-50 overflow-y-auto",role:"dialog","aria-modal":"true"},Le={class:"flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"},He={class:"inline-block align-bottom bg-white rounded-2xl text-left overflow-hidden shadow-2xl transform transition-all sm:my-8 sm:align-middle sm:max-w-md sm:w-full border border-slate-100"},Ue={class:"px-8 pt-8 pb-6"},$e={class:"flex items-center justify-between mb-6"},We={class:"space-y-4"},Ie={class:"relative"},Ee=["disabled"],Ge={key:0,class:"animate-spin h-4 w-4 text-white",fill:"none",viewBox:"0 0 24 24"},Ke=$({__name:"index",setup(Oe){const p=W(),o=d({balance:0,netChange:0,totalTransactions:0,totalDeposits:0,depositCount:0,totalDeductions:0,deductionCount:0,planType:"prepaid"}),k=d([]),i=d(null),_=d(!0),v=d(!1),c=d(null),u=d(!1),C=d(""),T=d(""),R=async()=>{try{const l=await y.getWalletStats("operating");o.value=l||o.value}catch(l){console.error("Failed to fetch wallet stats",l)}},b=async(l=1)=>{try{_.value=!0;const t=await y.getTransactions({page:l,limit:10,search:C.value,status:T.value||void 0,walletType:"operating"});k.value=t.data,i.value=t.meta,o.value.planType=t.planType||o.value.planType}catch(t){console.error("Failed to fetch transactions",t)}finally{_.value=!1}},h=()=>{R(),b(1)};let M=null;const L=()=>{clearTimeout(M),M=setTimeout(()=>{b(1)},500)},H=async l=>{try{l.loadingRequery=!0,await y.requeryTransaction(l._id),h()}catch(t){console.error("Requery failed",t),alert("Requery failed. The transaction might still be processing on Paystack.")}finally{l.loadingRequery=!1}},U=async()=>{if(c.value)try{if(u.value=!0,!window.PaystackPop)throw new Error("Payment service is currently unavailable. Please refresh the page.");const l=await y.initializeWalletFunding(c.value,p.query.year?Number(p.query.year):void 0,p.query.month?Number(p.query.month):void 0);window.PaystackPop.setup({key:l.paystackPublicKey||"pk_test_9d97cf0be86b0758ece444694d57a8db41a4be59",email:l.email,amount:Math.round(l.totalAmount*100),ref:l.reference,callback:g=>{(async()=>{try{await y.verifyWalletFunding(g.reference),v.value=!1,c.value=null,h()}catch(w){console.error("Payment verification failed",w)}})()},onClose:()=>{u.value=!1}}).openIframe()}catch(l){console.error("Funding failed",l),u.value=!1}};return I(()=>{h(),p.query.autoFund==="true"&&p.query.amount&&(c.value=Number(p.query.amount),v.value=!0)}),(l,t)=>{var g,w,q;return r(),n("div",G,[e("div",K,[e("div",null,[e("h1",O,a(o.value.planType==="postpaid"?"Spending & Ledger":"Operating Wallet"),1),e("p",Q,a(o.value.planType==="postpaid"?"Track your cycle spending and view ledger history":"Manage your operating funds and view transaction history"),1)]),e("div",J,[o.value.planType==="postpaid"?(r(),n("button",{key:0,onClick:t[0]||(t[0]=s=>l.$router.push("/partner/reports")),class:"inline-flex items-center px-4 py-2 bg-white border border-slate-200 text-slate-700 text-sm font-bold rounded-xl hover:bg-slate-50 transition-colors"},[...t[8]||(t[8]=[e("svg",{class:"w-5 h-5 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 17v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2m3 2h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})],-1),f(" Billing Reports ",-1)])])):m("",!0)])]),e("div",X,[e("div",Y,[e("div",Z,[e("p",ee,a(o.value.planType==="postpaid"?"Cycle Spending":"Available Balance"),1),e("div",{class:x(["w-10 h-10 rounded-xl flex items-center justify-center",o.value.planType==="postpaid"?"bg-amber-50 text-amber-600":"bg-primary-50 text-primary-600"])},[...t[9]||(t[9]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M17 9V7a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2m2 4h10a2 2 0 002-2v-6a2 2 0 00-2-2H9a2 2 0 00-2 2v6a2 2 0 002 2zm7-5a2 2 0 11-4 0 2 2 0 014 0z"})],-1)])],2)]),e("h3",te," ₦"+a(((g=o.value.planType==="postpaid"?Math.abs(o.value.balance):o.value.balance)==null?void 0:g.toLocaleString())||0),1),o.value.planType!=="postpaid"?(r(),n("p",{key:0,class:x(["mt-2 text-xs font-medium",o.value.netChange>=0?"text-emerald-600":"text-rose-600"])},a(o.value.netChange>=0?"+":"")+"₦"+a(Math.abs(o.value.netChange||0).toLocaleString())+" Net Change ",3)):(r(),n("p",se," Accumulated for current cycle "))]),e("div",ae,[t[10]||(t[10]=j('<div class="flex items-center justify-between mb-4"><p class="text-sm font-medium text-slate-500">Transactions</p><div class="w-10 h-10 bg-slate-50 text-slate-600 rounded-xl flex items-center justify-center"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div></div>',1)),e("h3",oe,a(o.value.totalTransactions||0),1),t[11]||(t[11]=e("p",{class:"mt-2 text-xs text-slate-400 font-medium"},"Activity Count",-1))]),e("div",le,[e("div",ne,[e("p",re,a(o.value.planType==="postpaid"?"Total Settlements":"Total Deposits"),1),t[12]||(t[12]=e("div",{class:"w-10 h-10 bg-emerald-50 text-emerald-600 rounded-xl flex items-center justify-center"},[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})])],-1))]),e("h3",ie,"₦"+a(((w=o.value.totalDeposits)==null?void 0:w.toLocaleString())||0),1),e("p",de,a(o.value.depositCount||0)+" Completed",1)]),e("div",ce,[t[13]||(t[13]=j('<div class="flex items-center justify-between mb-4"><p class="text-sm font-medium text-slate-500">Total Deductions</p><div class="w-10 h-10 bg-rose-50 text-rose-600 rounded-xl flex items-center justify-center"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 16V10m0 0l3 3m-3-3l-3 3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path></svg></div></div>',1)),e("h3",pe,"₦"+a(((q=o.value.totalDeductions)==null?void 0:q.toLocaleString())||0),1),e("p",ue,a(o.value.deductionCount||0)+" Requests",1)])]),e("div",me,[e("div",xe,[S(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>C.value=s),onInput:L,type:"text",placeholder:"Filter by reference or notes...",class:"w-full pl-10 pr-4 py-2.5 bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 outline-none transition-all text-sm"},null,544),[[B,C.value]]),t[14]||(t[14]=e("svg",{class:"absolute left-3.5 top-3.5 w-4 h-4 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),e("div",ve,[S(e("select",{"onUpdate:modelValue":t[2]||(t[2]=s=>T.value=s),onChange:h,class:"px-4 py-2.5 text-sm bg-white border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 outline-none text-slate-700"},[...t[15]||(t[15]=[e("option",{value:""},"All Statuses",-1),e("option",{value:"completed"},"Completed",-1),e("option",{value:"pending"},"Pending",-1),e("option",{value:"failed"},"Failed",-1)])],544),[[E,T.value]])])]),e("div",fe,[e("div",ye,[e("table",be,[t[20]||(t[20]=e("thead",null,[e("tr",{class:"bg-slate-50"},[e("th",{scope:"col",class:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Reference ID"),e("th",{scope:"col",class:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Detail"),e("th",{scope:"col",class:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Type"),e("th",{scope:"col",class:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Value"),e("th",{scope:"col",class:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Status"),e("th",{scope:"col",class:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Timestamp"),e("th",{scope:"col",class:"px-6 py-4 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Actions")])],-1)),e("tbody",he,[_.value?(r(),n(A,{key:0},F(5,s=>e("tr",{key:s},[...t[16]||(t[16]=[e("td",{colspan:"7",class:"px-6 py-4 text-center"},[e("div",{class:"h-4 bg-slate-50 rounded animate-pulse w-full"})],-1)])])),64)):k.value.length===0?(r(),n("tr",ge,[...t[17]||(t[17]=[e("td",{colspan:"7",class:"px-6 py-12 text-center text-slate-500"},"No transactions found.",-1)])])):m("",!0),(r(!0),n(A,null,F(k.value,s=>{var P,V,D,z;return r(),n("tr",{key:s._id,class:"hover:bg-slate-50/50 transition-colors"},[e("td",we,"#"+a(((P=s.reference)==null?void 0:P.toUpperCase())||"N/A"),1),e("td",ke,[e("div",_e,a(s.reason),1),e("div",Ce,a(((V=s.metadata)==null?void 0:V.notes)||"System transaction"),1)]),e("td",Te,[e("span",{class:x(["px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider",s.transactionType==="credit"?"bg-emerald-50 text-emerald-600":"bg-slate-50 text-slate-600"])},a(s.transactionType==="credit"?"Deposit":"Debit"),3)]),e("td",je,[e("span",{class:x(["font-bold tabular-nums",s.transactionType==="credit"?"text-emerald-600":"text-slate-900"])},a(s.transactionType==="credit"?"+":"-")+"₦"+a(((D=s.nairaAmount)==null?void 0:D.toLocaleString())||0),3)]),e("td",Se,[e("span",{class:x(["inline-flex items-center px-1.5 py-0.5 rounded-full text-xs font-medium",s.status==="completed"?"bg-emerald-100 text-emerald-700":s.status==="pending"?"bg-amber-100 text-amber-700":"bg-rose-100 text-rose-700"])},[e("span",{class:x(["w-1 h-1 rounded-full mr-1.5",s.status==="completed"?"bg-emerald-500":s.status==="pending"?"bg-amber-500":"bg-rose-500"])},null,2),f(" "+a((z=s.status)==null?void 0:z.toUpperCase()),1)],2)]),e("td",Me,[f(a(new Date(s.createdAt).toLocaleDateString("en-GB")),1),t[18]||(t[18]=e("br",null,null,-1)),f(" "+a(new Date(s.createdAt).toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit"})),1)]),e("td",qe,[s.status==="pending"?(r(),n("button",{key:0,onClick:Qe=>H(s),disabled:s.loadingRequery,class:"text-primary-600 hover:text-primary-900 font-bold flex items-center justify-end ml-auto"},[s.loadingRequery?(r(),n("svg",Ve,[...t[19]||(t[19]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):m("",!0),f(" "+a(s.loadingRequery?"Syncing...":"Requery"),1)],8,Pe)):(r(),n("span",De,"-"))])])}),128))])])]),i.value&&i.value.pages>1?(r(),n("div",ze,[e("span",Be,"Page "+a(i.value.page)+" of "+a(i.value.pages),1),e("div",Ae,[e("button",{onClick:t[3]||(t[3]=s=>b(i.value.page-1)),disabled:i.value.page===1,class:"px-3 py-1 bg-white border border-slate-200 rounded-lg text-xs font-medium text-slate-600 hover:bg-slate-50 disabled:opacity-50"}," Prev ",8,Fe),e("button",{onClick:t[4]||(t[4]=s=>b(i.value.page+1)),disabled:i.value.page===i.value.pages,class:"px-3 py-1 bg-white border border-slate-200 rounded-lg text-xs font-medium text-slate-600 hover:bg-slate-50 disabled:opacity-50"}," Next ",8,Ne)])])):m("",!0)]),v.value?(r(),n("div",Re,[e("div",Le,[e("div",{class:"fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity",onClick:t[5]||(t[5]=s=>v.value=!1)}),t[27]||(t[27]=e("span",{class:"hidden sm:inline-block sm:align-middle sm:h-screen","aria-hidden":"true"},"​",-1)),e("div",He,[e("div",Ue,[e("div",$e,[t[22]||(t[22]=e("h3",{class:"text-xl font-bold text-slate-900"},"Fund Wallet",-1)),e("button",{onClick:t[6]||(t[6]=s=>v.value=!1),class:"text-slate-400 hover:text-slate-600"},[...t[21]||(t[21]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l18 18"})],-1)])])]),e("div",We,[e("div",null,[t[24]||(t[24]=e("label",{class:"block text-xs font-bold text-slate-400 uppercase tracking-widest mb-2"},"Deposit Amount (NGN)",-1)),e("div",Ie,[t[23]||(t[23]=e("span",{class:"absolute left-4 top-1/2 -translate-y-1/2 text-slate-400 font-bold"},"₦",-1)),S(e("input",{"onUpdate:modelValue":t[7]||(t[7]=s=>c.value=s),type:"number",placeholder:"Enter amount",class:"w-full pl-10 pr-4 py-3 bg-slate-50 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 outline-none transition-all font-bold"},null,512),[[B,c.value]])])]),t[26]||(t[26]=j('<div class="bg-primary-50 p-4 rounded-xl border border-primary-100"><div class="flex items-start space-x-3 text-primary-700"><svg class="w-5 h-5 mt-0.5 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><p class="text-xs font-medium leading-relaxed"> Deposits are processed securely via Paystack. Funds will be credited to your available balance instantly. </p></div></div>',1)),e("button",{onClick:U,disabled:!c.value||c.value<=0||u.value,class:"w-full py-4 bg-primary-500 text-white font-bold rounded-xl hover:bg-primary-600 disabled:opacity-50 transition-all shadow-lg shadow-primary-500/25 flex items-center justify-center space-x-2"},[u.value?(r(),n("svg",Ge,[...t[25]||(t[25]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])])):m("",!0),e("span",null,a(u.value?"Initializing Secure Payment...":"Proceed to Payment"),1)],8,Ee)])])])])])):m("",!0)])}}});typeof N=="function"&&N(Ke);export{Ke as default};
