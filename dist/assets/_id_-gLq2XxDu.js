import{d as M,k as O,r as S,c as z,o as I,i as R,a,j as i,b as e,h as C,w as D,t as o,n as j,q as n,e as u,F as A,f as N,C as V}from"./index-DPa4r9b9.js";import{S as b}from"./subscription.service-D7a8DyVD.js";import{O as T}from"./order.service-DuXVhfDF.js";import"./api-4GkiaaGr.js";const q={key:0,class:"space-y-6"},F={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},H={class:"flex items-center space-x-3"},$={class:"text-2xl font-bold text-slate-900"},P={class:"mt-1 text-sm text-slate-500 ml-9"},E={class:"font-mono text-xs"},Q={class:"flex items-center space-x-3 ml-9 sm:ml-0"},G={class:"grid grid-cols-1 lg:grid-cols-3 gap-6"},J={class:"lg:col-span-2 space-y-6"},K={class:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden"},U={role:"list",class:"divide-y divide-slate-100"},W={class:"flex-shrink-0 h-16 w-16 bg-slate-100 rounded-lg overflow-hidden border border-slate-200"},X=["src"],Y={key:1,class:"h-full w-full flex items-center justify-center text-slate-400"},Z={class:"ml-4 flex-1"},ee={class:"text-sm font-medium text-slate-900"},te={class:"text-xs text-slate-500"},se={class:"text-sm font-medium text-slate-900"},oe={class:"p-4 sm:px-6 bg-slate-50 flex justify-between items-center"},le={class:"text-lg font-bold text-primary-700"},re={class:"grid grid-cols-1 sm:grid-cols-3 gap-4"},ae={class:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100"},ie={class:"mt-1 text-2xl font-bold text-slate-900"},ne={class:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100"},de={class:"mt-1 text-2xl font-bold text-slate-900"},ue={class:"bg-white p-4 rounded-2xl shadow-sm border border-slate-100"},ce={class:"mt-1 text-2xl font-bold text-slate-900"},me={class:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden"},pe={class:"overflow-x-auto"},xe={class:"min-w-full divide-y divide-slate-200"},ve={class:"divide-y divide-slate-100"},fe={class:"px-6 py-3 whitespace-nowrap text-sm font-medium text-primary-600"},be={class:"px-6 py-3 whitespace-nowrap text-sm text-slate-600"},he={class:"px-6 py-3 whitespace-nowrap"},ge={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-slate-100 text-slate-800 capitalize"},we={class:"px-6 py-3 whitespace-nowrap text-sm font-medium text-slate-900"},ye={class:"px-6 py-3 whitespace-nowrap text-right text-sm font-medium"},_e={key:0},ke={class:"space-y-6"},Se={class:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden"},Ce={class:"p-6"},De={class:"flex items-center mb-4"},je={class:"h-10 w-10 rounded-full bg-primary-100 flex items-center justify-center text-primary-700 font-bold"},Ae={class:"ml-3"},Ne={class:"text-sm font-medium text-slate-900"},Ve={class:"space-y-3 text-sm"},Le={class:"flex items-start"},Be={class:"text-slate-600"},Me={class:"flex items-start"},Oe={class:"text-slate-600"},ze={class:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden"},Ie={class:"p-6 space-y-4"},Re={class:"mt-1 text-sm font-medium text-slate-900 capitalize"},Te={class:"mt-1 text-sm font-medium text-slate-900"},qe={class:"mt-1 text-sm font-medium text-primary-700"},Fe={class:"mt-1 text-sm font-medium text-slate-900"},He={class:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden"},$e={class:"p-6 text-sm text-slate-600"},Pe={class:"font-medium text-slate-900 mb-1"},Ee={key:1,class:"flex items-center justify-center py-20"},Qe=M({__name:"[id]",setup(Ge){const h=O(),s=S(null),d=S([]),x=z(()=>{const r=d.value.length,t=d.value.reduce((m,p)=>m+p.totalAmount,0),c=r>0?t/r:0;return{totalOrders:r,totalSpend:t,avgOrderValue:c}}),v=async()=>{try{const[r,t]=await Promise.all([b.getSubscription(h.params.id),T.getOrders({subscriptionId:h.params.id,limit:100})]);s.value=r.data,d.value=t.data.orders}catch(r){console.error("Failed to fetch subscription details",r)}},f=async r=>{if(confirm(`Are you sure you want to ${r} this subscription?`))try{await b.updateStatus(s.value._id,r),await v()}catch(t){alert("Failed to update status"),console.error(t)}},L=async()=>{if(confirm("This will create a new order immediately. Continue?"))try{await b.manualRenew(s.value._id),alert("Renewal order created successfully"),await v()}catch(r){alert("Failed to trigger renewal"),console.error(r)}},B=()=>{f("cancelled")};return I(()=>{v()}),(r,t)=>{var m,p,g,w,y,_;const c=R("router-link");return s.value?(i(),a("div",q,[e("div",F,[e("div",null,[e("div",H,[C(c,{to:"/admin/subscriptions",class:"p-2 -ml-2 text-slate-400 hover:text-slate-600 rounded-lg hover:bg-slate-100 transition-colors"},{default:D(()=>[...t[2]||(t[2]=[e("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])]),_:1}),e("h1",$,o(s.value.name),1),e("span",{class:j(["inline-flex items-center px-3 py-1 rounded-full text-xs font-semibold",{"bg-emerald-100 text-emerald-700":s.value.status==="active","bg-amber-100 text-amber-700":s.value.status==="paused","bg-slate-100 text-slate-600":s.value.status==="cancelled"}])},[e("span",{class:j(["w-1.5 h-1.5 rounded-full mr-2",{"bg-emerald-500":s.value.status==="active","bg-amber-500":s.value.status==="paused","bg-slate-400":s.value.status==="cancelled"}])},null,2),n(" "+o(s.value.status),1)],2)]),e("p",P,[t[3]||(t[3]=n("ID: ",-1)),e("span",E,o(s.value._id),1)])]),e("div",Q,[s.value.status==="active"?(i(),a("button",{key:0,onClick:t[0]||(t[0]=l=>f("paused")),class:"inline-flex items-center px-4 py-2 border border-slate-200 shadow-sm text-sm font-medium rounded-xl text-slate-700 bg-white hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},[...t[4]||(t[4]=[e("svg",{class:"w-4 h-4 mr-2 text-amber-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),n(" Pause Subscription ",-1)])])):u("",!0),s.value.status==="paused"?(i(),a("button",{key:1,onClick:t[1]||(t[1]=l=>f("active")),class:"inline-flex items-center px-4 py-2 border border-slate-200 shadow-sm text-sm font-medium rounded-xl text-slate-700 bg-white hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},[...t[5]||(t[5]=[e("svg",{class:"w-4 h-4 mr-2 text-emerald-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),n(" Resume Subscription ",-1)])])):u("",!0),s.value.status!=="cancelled"?(i(),a("button",{key:2,onClick:L,class:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-xl text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500"},[...t[6]||(t[6]=[e("svg",{class:"w-4 h-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"})],-1),n(" Trigger Renewal ",-1)])])):u("",!0),s.value.status!=="cancelled"?(i(),a("button",{key:3,onClick:B,class:"inline-flex items-center px-4 py-2 border border-rose-200 shadow-sm text-sm font-medium rounded-xl text-rose-700 bg-rose-50 hover:bg-rose-100 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-rose-500"}," Cancel ")):u("",!0)])]),e("div",G,[e("div",J,[e("div",K,[t[9]||(t[9]=e("div",{class:"px-6 py-4 border-b border-slate-100 bg-slate-50/50"},[e("h3",{class:"text-base font-semibold text-slate-900"},"Subscription Items")],-1)),e("ul",U,[(i(!0),a(A,null,N(s.value.items,l=>(i(),a("li",{key:l.product._id,class:"p-4 sm:px-6 flex items-center"},[e("div",W,[l.image?(i(),a("img",{key:0,src:l.image,class:"h-full w-full object-cover"},null,8,X)):(i(),a("div",Y,[...t[7]||(t[7]=[e("svg",{class:"w-8 h-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1)])]))]),e("div",Z,[e("h4",ee,o(l.title),1),e("p",te,"Qty: "+o(l.quantity),1)]),e("div",se," ₦"+o(((l.price||0)*l.quantity).toLocaleString()),1)]))),128)),e("li",oe,[t[8]||(t[8]=e("span",{class:"text-sm font-medium text-slate-600"},"Total Value",-1)),e("span",le," ₦"+o(s.value.items.reduce((l,k)=>l+(k.price||0)*k.quantity,0).toLocaleString()),1)])])]),e("div",re,[e("div",ae,[t[10]||(t[10]=e("p",{class:"text-sm font-medium text-slate-500"},"Total Spend",-1)),e("p",ie,"₦"+o(x.value.totalSpend.toLocaleString()),1)]),e("div",ne,[t[11]||(t[11]=e("p",{class:"text-sm font-medium text-slate-500"},"Total Orders",-1)),e("p",de,o(x.value.totalOrders),1)]),e("div",ue,[t[12]||(t[12]=e("p",{class:"text-sm font-medium text-slate-500"},"Avg. Order Value",-1)),e("p",ce,"₦"+o(x.value.avgOrderValue.toLocaleString()),1)])]),e("div",me,[t[16]||(t[16]=e("div",{class:"px-6 py-4 border-b border-slate-100 bg-slate-50/50 flex justify-between items-center"},[e("h3",{class:"text-base font-semibold text-slate-900"},"Order History")],-1)),e("div",pe,[e("table",xe,[t[15]||(t[15]=e("thead",null,[e("tr",{class:"bg-slate-50"},[e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Order"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Date"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Status"),e("th",{scope:"col",class:"px-6 py-3 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Total"),e("th",{scope:"col",class:"relative px-6 py-3"},[e("span",{class:"sr-only"},"View")])])],-1)),e("tbody",ve,[(i(!0),a(A,null,N(d.value,l=>(i(),a("tr",{key:l._id,class:"hover:bg-slate-50/50"},[e("td",fe,"#"+o(l.orderNumber),1),e("td",be,o(new Date(l.createdAt).toLocaleDateString()),1),e("td",he,[e("span",ge,o(l.orderStatus),1)]),e("td",we,"₦"+o(l.totalAmount.toLocaleString()),1),e("td",ye,[C(c,{to:`/admin/orders/${l._id}`,class:"text-primary-600 hover:text-primary-900"},{default:D(()=>[...t[13]||(t[13]=[n("View",-1)])]),_:1},8,["to"])])]))),128)),d.value.length===0?(i(),a("tr",_e,[...t[14]||(t[14]=[e("td",{colspan:"5",class:"px-6 py-10 text-center text-sm text-slate-500"},"No orders found for this subscription yet.",-1)])])):u("",!0)])])])])]),e("div",ke,[e("div",Se,[t[20]||(t[20]=e("div",{class:"px-6 py-4 border-b border-slate-100 bg-slate-50/50"},[e("h3",{class:"text-base font-semibold text-slate-900"},"Customer")],-1)),e("div",Ce,[e("div",De,[e("div",je,o((p=(m=s.value.userId)==null?void 0:m.firstName)==null?void 0:p.charAt(0)),1),e("div",Ae,[e("p",Ne,o((g=s.value.userId)==null?void 0:g.firstName)+" "+o((w=s.value.userId)==null?void 0:w.lastName),1),t[17]||(t[17]=e("p",{class:"text-xs text-slate-500"},"Customer",-1))])]),e("div",Ve,[e("div",Le,[t[18]||(t[18]=e("svg",{class:"w-4 h-4 text-slate-400 mt-0.5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})],-1)),e("span",Be,o((y=s.value.userId)==null?void 0:y.email),1)]),e("div",Me,[t[19]||(t[19]=e("svg",{class:"w-4 h-4 text-slate-400 mt-0.5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})],-1)),e("span",Oe,o(((_=s.value.userId)==null?void 0:_.phone)||"No phone"),1)])])])]),e("div",ze,[t[25]||(t[25]=e("div",{class:"px-6 py-4 border-b border-slate-100 bg-slate-50/50"},[e("h3",{class:"text-base font-semibold text-slate-900"},"Schedule")],-1)),e("div",Ie,[e("div",null,[t[21]||(t[21]=e("p",{class:"text-xs font-medium text-slate-500 uppercase tracking-wider"},"Frequency",-1)),e("p",Re,o(s.value.frequency),1)]),e("div",null,[t[22]||(t[22]=e("p",{class:"text-xs font-medium text-slate-500 uppercase tracking-wider"},"Start Date",-1)),e("p",Te,o(new Date(s.value.startDate).toLocaleDateString()),1)]),e("div",null,[t[23]||(t[23]=e("p",{class:"text-xs font-medium text-slate-500 uppercase tracking-wider"},"Next Delivery",-1)),e("p",qe,o(new Date(s.value.nextDeliveryDate).toLocaleDateString()),1)]),e("div",null,[t[24]||(t[24]=e("p",{class:"text-xs font-medium text-slate-500 uppercase tracking-wider"},"Next Billing",-1)),e("p",Fe,o(new Date(s.value.nextBillingDate).toLocaleDateString()),1)])])]),e("div",He,[t[26]||(t[26]=e("div",{class:"px-6 py-4 border-b border-slate-100 bg-slate-50/50"},[e("h3",{class:"text-base font-semibold text-slate-900"},"Delivery Address")],-1)),e("div",$e,[e("p",Pe,o(s.value.deliveryAddress.firstName)+" "+o(s.value.deliveryAddress.lastName),1),e("p",null,o(s.value.deliveryAddress.street),1),e("p",null,o(s.value.deliveryAddress.city)+", "+o(s.value.deliveryAddress.state),1),e("p",null,o(s.value.deliveryAddress.phone),1)])])])])])):(i(),a("div",Ee,[...t[27]||(t[27]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600"},null,-1)])]))}}});typeof V=="function"&&V(Qe);export{Qe as default};
