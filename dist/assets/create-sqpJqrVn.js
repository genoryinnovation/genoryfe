import{d as _,k as q,u as P,c as A,r as y,x as T,o as E,i as N,a,j as n,b as t,t as u,p as l,z as i,A as w,B as L,e as M,F as k,f as U,h as D,w as j,q as B,E as R,C as h}from"./index-DPa4r9b9.js";import{S as x}from"./special_offer.service-BEVs3jSu.js";import{C as G}from"./catalog.service-BFW32g3N.js";import"./api-4GkiaaGr.js";const $={class:"space-y-6"},z={class:"flex flex-col sm:flex-row sm:items-center sm:justify-between"},H={class:"text-2xl font-bold text-slate-900"},Q={class:"mt-1 text-sm text-slate-500"},W={class:"bg-white rounded-2xl shadow-sm border border-slate-100 p-6 space-y-6"},X={class:"grid grid-cols-1 gap-6 sm:grid-cols-2"},J={class:"sm:col-span-2"},K={class:"sm:col-span-2"},Y={class:"bg-white rounded-2xl shadow-sm border border-slate-100 p-6 space-y-6"},Z={class:"grid grid-cols-1 gap-6 sm:grid-cols-2"},ee={class:"flex items-center space-x-2 cursor-pointer mt-6"},te={class:"bg-white rounded-2xl shadow-sm border border-slate-100 p-6 space-y-6"},se={class:"grid grid-cols-1 gap-6 sm:grid-cols-2"},re={class:"bg-white rounded-2xl shadow-sm border border-slate-100 p-6 space-y-6"},oe={class:"space-y-4"},le={class:"flex space-x-2"},ie={key:0,class:"border border-slate-200 rounded-xl overflow-hidden max-h-60 overflow-y-auto"},ae=["onClick"],ne={class:"flex items-center space-x-3"},de=["src"],ue={class:"text-sm font-medium"},me={class:"text-xs text-slate-500"},pe={key:1,class:"space-y-2"},ce={class:"flex items-center space-x-3"},fe={class:"text-sm font-medium text-slate-900"},be={class:"flex items-center space-x-4"},xe=["onUpdate:modelValue"],ve=["onClick"],ge={key:2,class:"text-sm text-slate-500 text-center py-4"},ye={class:"flex justify-end space-x-3"},we={type:"submit",class:"px-6 py-3 text-sm font-semibold text-white bg-gradient-to-r from-primary-500 to-primary-600 rounded-xl hover:from-primary-600 hover:to-primary-700 transition-all shadow-lg shadow-primary-500/25"},ke=_({__name:"create",setup(Ue){const f=q(),O=P(),m=A(()=>!!f.params.id),p=y(""),c=y([]);let v;const s=T({title:"",description:"",image:"",type:"SINGLE",items:[],price:0,originalPrice:0,criteria:{minOrders:0,targetUser:"ALL"},validFrom:"",validUntil:"",isActive:!0}),S=async()=>{if(m.value)try{const e=(await x.getOffer(f.params.id)).data;s.title=e.title,s.description=e.description||"",s.image=e.image,s.type=e.type,s.items=e.items.map(d=>({product:d.product,quantity:d.quantity})),s.price=e.price,s.originalPrice=e.originalPrice||0,s.criteria=e.criteria,s.validFrom=new Date(e.validFrom).toISOString().slice(0,16),s.validUntil=new Date(e.validUntil).toISOString().slice(0,16),s.isActive=e.isActive}catch(o){console.error("Failed to fetch offer",o)}},C=()=>{if(!p.value){c.value=[];return}clearTimeout(v),v=setTimeout(async()=>{try{const o=await G.getProducts(1,10,p.value);c.value=o.data.products}catch(o){console.error("Failed to search products",o)}},300)},V=o=>{s.items.find(d=>d.product._id===o._id)||s.items.push({product:o,quantity:1}),c.value=[],p.value=""},I=o=>{s.items.splice(o,1)},F=async()=>{try{const o={...s,items:s.items.map(e=>({product:e.product._id,quantity:e.quantity})),validFrom:new Date(s.validFrom).toISOString(),validUntil:new Date(s.validUntil).toISOString()};m.value?await x.updateOffer(f.params.id,o):await x.createOffer(o),O.push("/admin/special-offers")}catch(o){console.error("Failed to save offer",o),alert("Failed to save offer. Check console for details.")}};return E(()=>{S()}),(o,e)=>{const d=N("router-link");return n(),a("div",$,[t("div",z,[t("div",null,[t("h1",H,u(m.value?"Edit Special Offer":"Create Special Offer"),1),t("p",Q,u(m.value?"Update existing offer details":"Configure a new promotional offer"),1)])]),t("form",{onSubmit:R(F,["prevent"]),class:"space-y-6"},[t("div",W,[e[17]||(e[17]=t("h2",{class:"text-lg font-semibold text-slate-900"},"Basic Information",-1)),t("div",X,[t("div",null,[e[12]||(e[12]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Title",-1)),l(t("input",{"onUpdate:modelValue":e[0]||(e[0]=r=>s.title=r),type:"text",required:"",class:"block w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"},null,512),[[i,s.title]])]),t("div",null,[e[14]||(e[14]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Type",-1)),l(t("select",{"onUpdate:modelValue":e[1]||(e[1]=r=>s.type=r),class:"block w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"},[...e[13]||(e[13]=[t("option",{value:"SINGLE"},"Single Item",-1),t("option",{value:"COMBO"},"Combo Deal",-1)])],512),[[w,s.type]])]),t("div",J,[e[15]||(e[15]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Description",-1)),l(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=r=>s.description=r),rows:"3",class:"block w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"},null,512),[[i,s.description]])]),t("div",K,[e[16]||(e[16]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Image URL",-1)),l(t("input",{"onUpdate:modelValue":e[3]||(e[3]=r=>s.image=r),type:"url",required:"",class:"block w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"},null,512),[[i,s.image]])])])]),t("div",Y,[e[23]||(e[23]=t("h2",{class:"text-lg font-semibold text-slate-900"},"Pricing & Validity",-1)),t("div",Z,[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Offer Price (₦)",-1)),l(t("input",{"onUpdate:modelValue":e[4]||(e[4]=r=>s.price=r),type:"number",required:"",min:"0",class:"block w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"},null,512),[[i,s.price,void 0,{number:!0}]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Original Price (₦)",-1)),l(t("input",{"onUpdate:modelValue":e[5]||(e[5]=r=>s.originalPrice=r),type:"number",min:"0",class:"block w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"},null,512),[[i,s.originalPrice,void 0,{number:!0}]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Valid From",-1)),l(t("input",{"onUpdate:modelValue":e[6]||(e[6]=r=>s.validFrom=r),type:"datetime-local",required:"",class:"block w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"},null,512),[[i,s.validFrom]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Valid Until",-1)),l(t("input",{"onUpdate:modelValue":e[7]||(e[7]=r=>s.validUntil=r),type:"datetime-local",required:"",class:"block w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"},null,512),[[i,s.validUntil]])]),t("div",null,[t("label",ee,[l(t("input",{"onUpdate:modelValue":e[8]||(e[8]=r=>s.isActive=r),type:"checkbox",class:"w-5 h-5 text-primary-600 rounded border-slate-300 focus:ring-primary-500"},null,512),[[L,s.isActive]]),e[22]||(e[22]=t("span",{class:"text-sm font-medium text-slate-900"},"Is Active?",-1))])])])]),t("div",te,[e[27]||(e[27]=t("h2",{class:"text-lg font-semibold text-slate-900"},"Eligibility Criteria",-1)),t("div",se,[t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Minimum Completed Orders",-1)),l(t("input",{"onUpdate:modelValue":e[9]||(e[9]=r=>s.criteria.minOrders=r),type:"number",min:"0",class:"block w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"},null,512),[[i,s.criteria.minOrders,void 0,{number:!0}]])]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm font-medium text-slate-700 mb-2"},"Target User Type",-1)),l(t("select",{"onUpdate:modelValue":e[10]||(e[10]=r=>s.criteria.targetUser=r),class:"block w-full px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all"},[...e[25]||(e[25]=[t("option",{value:"ALL"},"All Users",-1),t("option",{value:"NEW"},"New Users Only (0 orders)",-1),t("option",{value:"EXISTING"},"Existing Users Only (>0 orders)",-1)])],512),[[w,s.criteria.targetUser]])])])]),t("div",re,[e[30]||(e[30]=t("h2",{class:"text-lg font-semibold text-slate-900"},"Included Products",-1)),t("div",oe,[t("div",le,[l(t("input",{"onUpdate:modelValue":e[11]||(e[11]=r=>p.value=r),type:"text",placeholder:"Search products by title...",class:"block flex-1 px-4 py-3 bg-slate-50 border border-slate-200 rounded-xl text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent transition-all",onInput:C},null,544),[[i,p.value]])]),c.value.length>0?(n(),a("div",ie,[(n(!0),a(k,null,U(c.value,r=>(n(),a("div",{key:r._id,class:"px-4 py-2 hover:bg-slate-50 cursor-pointer flex justify-between items-center",onClick:b=>V(r)},[t("div",ne,[t("img",{src:r.images[0]||"https://via.placeholder.com/32",class:"w-8 h-8 rounded object-cover"},null,8,de),t("span",ue,u(r.title),1)]),t("span",me,u(r.sku),1)],8,ae))),128))])):M("",!0),s.items.length>0?(n(),a("div",pe,[(n(!0),a(k,null,U(s.items,(r,b)=>(n(),a("div",{key:b,class:"flex items-center justify-between bg-slate-50 p-3 rounded-xl"},[t("div",ce,[t("span",fe,u(r.product.title),1)]),t("div",be,[e[29]||(e[29]=t("label",{class:"text-xs text-slate-500"},"Qty:",-1)),l(t("input",{"onUpdate:modelValue":g=>r.quantity=g,type:"number",min:"1",class:"w-16 px-2 py-1 bg-white border border-slate-200 rounded text-sm"},null,8,xe),[[i,r.quantity,void 0,{number:!0}]]),t("button",{type:"button",onClick:g=>I(b),class:"text-rose-500 hover:text-rose-700"},[...e[28]||(e[28]=[t("svg",{class:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})],-1)])],8,ve)])]))),128))])):(n(),a("p",ge,"No products selected."))])]),t("div",ye,[D(d,{to:"/admin/special-offers",class:"px-6 py-3 text-sm font-medium text-slate-700 bg-white border border-slate-200 rounded-xl hover:bg-slate-50 transition-colors"},{default:j(()=>[...e[31]||(e[31]=[B(" Cancel ",-1)])]),_:1}),t("button",we,u(m.value?"Update Offer":"Create Offer"),1)])],32)])}}});typeof h=="function"&&h(ke);export{ke as default};
