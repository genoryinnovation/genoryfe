import{d as k,u as C,r as x,o as S,a as n,j as i,b as t,g as u,e as M,F as h,f as m,t as a,n as g,q as R,C as y}from"./index-C8zvf3I_.js";import{P as b}from"./partner-portal.service-D36OMrJc.js";import"./api-4GkiaaGr.js";const B={class:"space-y-6"},T={class:"bg-white rounded-2xl shadow-sm border border-slate-100 overflow-hidden"},V={class:"overflow-x-auto"},j={class:"min-w-full divide-y divide-slate-200"},z={class:"divide-y divide-slate-100"},L={key:1},N={class:"px-6 py-4 whitespace-nowrap"},P={class:"flex items-center"},F={class:"w-10 h-10 bg-indigo-50 text-indigo-600 rounded-xl flex items-center justify-center mr-3 font-bold text-xs uppercase"},O={class:"font-bold text-slate-900"},$={class:"text-[10px] text-slate-400 font-medium uppercase tracking-widest"},q={class:"px-6 py-4 whitespace-nowrap text-sm text-slate-600 font-medium"},A={class:"px-6 py-4 whitespace-nowrap"},D={class:"text-sm font-black text-slate-900"},E={class:"px-6 py-4 whitespace-nowrap text-xs text-slate-500"},U={class:"px-6 py-4 whitespace-nowrap"},G={class:"px-6 py-4 whitespace-nowrap text-right space-x-2"},H=["onClick"],I=["onClick","disabled"],J=k({__name:"index",setup(K){const v=C(),r=x([]),d=x(!0),f=async()=>{try{d.value=!0;const o=await b.getMonthlyReports();r.value=o}catch(o){console.error("Failed to fetch monthly reports",o)}finally{d.value=!1}},p=o=>new Date(2e3,o-1).toLocaleString("default",{month:"long"}),w=async(o,s)=>{try{const e=await b.exportMonthlyReport(o,s),c=window.URL.createObjectURL(new Blob([e])),l=document.createElement("a");l.href=c,l.setAttribute("download",`Monthly_Report_${o}_${s}.csv`),document.body.appendChild(l),l.click(),l.remove()}catch(e){console.error("Failed to export report",e),alert("Failed to generate CSV. Please try again later.")}},_=o=>{v.push({path:"/partner/wallet",query:{amount:o.totalSpent.toString(),autoFund:"true",year:o._id.year.toString(),month:o._id.month.toString()}})};return S(f),(o,s)=>(i(),n("div",B,[s[5]||(s[5]=t("div",{class:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4"},[t("div",null,[t("h1",{class:"text-2xl font-bold text-slate-900"},"Reports & Billing"),t("p",{class:"mt-1 text-sm text-slate-500"},"Track monthly expenditures and reconcile balances")])],-1)),t("div",T,[t("div",V,[t("table",j,[s[3]||(s[3]=t("thead",null,[t("tr",{class:"bg-slate-50"},[t("th",{scope:"col",class:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Billing Month"),t("th",{scope:"col",class:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Total Orders"),t("th",{scope:"col",class:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Total Spent"),t("th",{scope:"col",class:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Last Activity"),t("th",{scope:"col",class:"px-6 py-4 text-left text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Status"),t("th",{scope:"col",class:"px-6 py-4 text-right text-xs font-semibold text-slate-600 uppercase tracking-wider"},"Actions")])],-1)),t("tbody",z,[d.value?(i(),n(h,{key:0},m(3,e=>t("tr",{key:e},[...s[0]||(s[0]=[t("td",{colspan:"5",class:"px-6 py-8"},[t("div",{class:"h-4 bg-slate-50 rounded animate-pulse w-full"})],-1)])])),64)):r.value.length===0?(i(),n("tr",L,[...s[1]||(s[1]=[t("td",{colspan:"5",class:"px-6 py-12 text-center text-slate-500"},"No reports generated yet.",-1)])])):M("",!0),(i(!0),n(h,null,m(r.value,e=>(i(),n("tr",{key:`${e._id.year}-${e._id.month}`,class:"hover:bg-slate-50/50 transition-colors"},[t("td",N,[t("div",P,[t("div",F,a(p(e._id.month).slice(0,3)),1),t("div",null,[t("p",O,a(p(e._id.month))+" "+a(e._id.year),1),t("p",$,a(e.planType)+" billing cycle",1)])])]),t("td",q,a(e.orderCount)+" Orders ",1),t("td",A,[t("p",D,"â‚¦"+a(e.totalSpent.toLocaleString()),1)]),t("td",E,a(new Date(e.lastTransactionAt).toLocaleDateString()),1),t("td",U,[t("span",{class:g(["px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest",e.status==="settled"?"bg-emerald-100 text-emerald-800":e.status==="overdue"?"bg-rose-100 text-rose-800":e.status==="due"?"bg-amber-100 text-amber-800":"bg-slate-100 text-slate-600"])},a(e.status==="settled"?"Settled":e.status==="overdue"?"Overdue":e.status==="due"?"Payment Due":"Open Cycle"),3)]),t("td",G,[t("button",{onClick:c=>w(e._id.year,e._id.month),class:"inline-flex items-center px-3 py-1.5 border border-slate-200 text-xs font-bold text-slate-600 rounded-lg hover:bg-slate-50 transition-colors"},[...s[2]||(s[2]=[t("svg",{class:"w-3.5 h-3.5 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[t("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),R(" Export CSV ",-1)])],8,H),t("button",{onClick:c=>_(e),disabled:e.status==="settled"||e.status==="open",class:g(["inline-flex items-center px-3 py-1.5 text-xs font-bold rounded-lg transition-colors",e.status==="settled"||e.status==="open"?"bg-slate-100 text-slate-400 cursor-not-allowed":"bg-primary-600 text-white hover:bg-primary-700"])},a(e.status==="settled"?"Settled":e.status==="open"?"Cycle Open":"Trigger Payment"),11,I)])]))),128))])])]),s[4]||(s[4]=u('<div class="p-6 bg-slate-50 border-t border-slate-100"><div class="flex items-start space-x-4"><div class="w-10 h-10 bg-amber-50 text-amber-600 rounded-xl flex items-center justify-center flex-shrink-0"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div><div><h4 class="text-sm font-bold text-slate-900">About Monthly Reconciliation</h4><p class="mt-1 text-xs text-slate-500 leading-relaxed max-w-2xl"> Monthly reports aggregate all employee spendings. The &quot;Trigger Payment&quot; action allows you to fund your company wallet with the total amount for that month, ensuring your account remains in good standing. Cleared status is automatically updated when your wallet balance covers the monthly expenditure. </p></div></div></div>',1))]),s[6]||(s[6]=u('<div class="grid grid-cols-1 md:grid-cols-2 gap-6"><div class="bg-indigo-600 rounded-2xl p-8 text-white shadow-lg overflow-hidden relative"><div class="relative z-10"><h3 class="text-xl font-bold mb-2">Need a Custom Report?</h3><p class="text-indigo-100 text-sm mb-6 opacity-80">Contact our support team if you require specialized data formats or reconciliation assistance.</p><button class="px-6 py-2.5 bg-white text-indigo-600 font-bold rounded-xl text-xs hover:bg-indigo-50 transition-colors"> Contact Support </button></div><svg class="absolute -right-4 -bottom-4 w-32 h-32 text-white/10" fill="currentColor" viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"></path></svg></div></div>',1))]))}});typeof y=="function"&&y(J);export{J as default};
