import{d as H,r as n,o as Q,i as G,a,j as r,b as e,e as c,p as S,z as A,F as $,f as z,t as o,n as V,h as J,w as K,q as _,C as D}from"./index-C8zvf3I_.js";import{P as M}from"./partner-portal.service-D36OMrJc.js";import"./api-4GkiaaGr.js";const W={class:"space-y-6"},X={class:"flex justify-between items-center"},Y={class:"flex space-x-3"},Z={class:"relative"},ee={class:"grid grid-cols-1 md:grid-cols-4 gap-6"},te={class:"text-sm font-medium text-slate-500"},se={class:"bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden relative"},oe={key:0,class:"absolute inset-0 bg-white/50 backdrop-blur-[2px] flex items-center justify-center z-10"},le={class:"w-full text-left border-collapse"},ae={class:"divide-y divide-slate-200"},re={key:0},ne={class:"px-6 py-4 font-medium text-slate-900"},ie={class:"px-6 py-4"},de={class:"text-slate-900 font-medium"},ue={class:"text-xs text-slate-500"},ce={class:"px-6 py-4 font-bold text-slate-900"},pe={class:"px-6 py-4 text-sm text-slate-500"},ve={class:"px-6 py-4"},xe={class:"px-6 py-4"},me={class:"flex space-x-2"},be=["onClick"],fe=["onClick"],ge={key:1,class:"px-6 py-4 bg-slate-50 border-t border-slate-200 flex items-center justify-between font-bold"},ye={class:"text-sm text-slate-500"},he={class:"text-slate-900"},_e={class:"text-slate-900"},we={class:"text-slate-900"},ke={class:"flex space-x-2"},Ce=["disabled"],je={class:"flex space-x-1"},Pe=["onClick"],Ne=["disabled"],Se={key:0,class:"fixed inset-0 bg-slate-900/50 backdrop-blur-sm flex items-center justify-center z-50 p-4"},Ae={class:"bg-white rounded-2xl shadow-xl w-full max-w-md overflow-hidden"},Ve={class:"p-6 border-b border-slate-100"},Oe={class:"text-xl font-bold text-slate-900"},Te={class:"p-6 space-y-4"},Re={key:0,class:"p-3 bg-rose-50 border border-rose-100 rounded-xl text-rose-600 text-sm font-medium animate-in fade-in slide-in-from-top-1"},$e={key:1,class:"p-3 bg-emerald-50 border border-emerald-100 rounded-xl text-emerald-600 text-sm font-medium animate-in fade-in slide-in-from-top-1"},ze={class:"text-slate-600 text-sm"},Ee={key:2,class:"space-y-1"},De={key:3,class:"space-y-1 animate-in slide-in-from-bottom-4 duration-300"},Me={class:"space-y-1"},Be={class:"pt-4 flex space-x-3"},Fe=["disabled"],Ie=H({__name:"index",setup(Ue){const m=n([]),p=n(!0),b=n([{label:"Total Requests",value:"0",colorClass:"text-slate-900"},{label:"Pending",value:"0",colorClass:"text-amber-600"},{label:"Approved",value:"0",colorClass:"text-emerald-600"},{label:"Rejected",value:"0",colorClass:"text-rose-600"}]),f=n(!1),u=n("approve"),w=n(null),g=n(""),k=n(""),y=n(""),C=n(""),x=n(""),j=n(!1),O=n(""),l=n(null),T=n(null),P=async(i=1)=>{var t;try{p.value=!0;const d=await M.getOrderRequests({page:i,limit:10,search:O.value});m.value=d.data,l.value=d.meta;const s=m.value.filter(v=>v.status==="pending").length,h=m.value.filter(v=>v.status==="approved").length,N=m.value.filter(v=>v.status==="rejected").length;b.value[0].value=((t=l.value)==null?void 0:t.total.toString())||"0",b.value[1].value=s.toString(),b.value[2].value=h.toString(),b.value[3].value=N.toString()}catch(d){console.error("Failed to fetch requests",d)}finally{p.value=!1}},B=()=>{T.value&&clearTimeout(T.value),T.value=setTimeout(()=>{P(1)},500)},R=i=>{P(i)},F=i=>{switch(i){case"pending":return"bg-amber-100 text-amber-800";case"approved":return"bg-emerald-100 text-emerald-800";case"rejected":return"bg-rose-100 text-rose-800";default:return"bg-slate-100 text-slate-800"}},I=i=>{w.value=i,u.value="approve",g.value="",k.value="",j.value=!1,y.value="",f.value=!0},U=i=>{w.value=i,u.value="reject",g.value="",y.value="",f.value=!0},L=async()=>{var i,t;if(w.value)try{C.value="",x.value="",p.value=!0;const d=await M.processOrder({requestId:w.value._id,action:u.value,pin:g.value,otp:k.value,notes:y.value});if(d&&d.requireOtp){j.value=!0,x.value="Verification code sent to your email.",setTimeout(()=>{x.value=""},3e3);return}x.value=`Order ${u.value==="approve"?"approved":"rejected"} successfully!`,await P(),setTimeout(()=>{f.value=!1,x.value=""},1500)}catch(d){console.error("Failed to process request",d),C.value=((t=(i=d.response)==null?void 0:i.data)==null?void 0:t.message)||`Failed to ${u.value} request.`}finally{p.value=!1}};return Q(P),(i,t)=>{const d=G("router-link");return r(),a("div",W,[e("div",X,[t[8]||(t[8]=e("div",null,[e("h1",{class:"text-2xl font-bold text-slate-900"},"Employee Orders"),e("p",{class:"text-slate-500"},"Track and approve food and grocery orders.")],-1)),e("div",Y,[e("div",Z,[S(e("input",{"onUpdate:modelValue":t[0]||(t[0]=s=>O.value=s),onInput:B,type:"text",placeholder:"Search orders...",class:"pl-10 pr-4 py-2 bg-white border border-slate-200 rounded-lg focus:ring-2 focus:ring-primary-500 outline-none w-64 transition-all"},null,544),[[A,O.value]]),t[7]||(t[7]=e("svg",{class:"w-5 h-5 text-slate-400 absolute left-3 top-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])])]),e("div",ee,[(r(!0),a($,null,z(b.value,s=>(r(),a("div",{key:s.label,class:"bg-white p-6 rounded-xl shadow-sm border border-slate-200"},[e("p",te,o(s.label),1),e("p",{class:V(["text-2xl font-bold mt-1",s.colorClass])},o(s.value),3)]))),128))]),e("div",se,[p.value?(r(),a("div",oe,[...t[9]||(t[9]=[e("svg",{class:"animate-spin h-8 w-8 text-primary-600",fill:"none",viewBox:"0 0 24 24"},[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"}),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})],-1)])])):c("",!0),e("table",le,[t[12]||(t[12]=e("thead",{class:"bg-slate-50 border-b border-slate-200"},[e("tr",null,[e("th",{class:"px-6 py-4 text-sm font-semibold text-slate-600"},"Order #"),e("th",{class:"px-6 py-4 text-sm font-semibold text-slate-600"},"Employee"),e("th",{class:"px-6 py-4 text-sm font-semibold text-slate-600"},"Amount"),e("th",{class:"px-6 py-4 text-sm font-semibold text-slate-600"},"Date"),e("th",{class:"px-6 py-4 text-sm font-semibold text-slate-600"},"Status"),e("th",{class:"px-6 py-4 text-sm font-semibold text-slate-600"},"Actions")])],-1)),e("tbody",ae,[m.value.length===0&&!p.value?(r(),a("tr",re,[...t[10]||(t[10]=[e("td",{colspan:"6",class:"px-6 py-12 text-center text-slate-500"},"No order requests found.",-1)])])):c("",!0),(r(!0),a($,null,z(m.value,s=>{var h,N,v,E;return r(),a("tr",{key:s._id,class:"hover:bg-slate-50 transition-colors"},[e("td",ne,o(((h=s.order)==null?void 0:h.orderNumber)||"N/A"),1),e("td",ie,[e("p",de,o((N=s.user)==null?void 0:N.firstName)+" "+o((v=s.user)==null?void 0:v.lastName),1),e("p",ue,o((E=s.user)==null?void 0:E.email),1)]),e("td",ce,"₦"+o(s.amount.toLocaleString()),1),e("td",pe,o(new Date(s.createdAt).toLocaleDateString()),1),e("td",ve,[e("span",{class:V(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",F(s.status)])},o(s.status),3)]),e("td",xe,[e("div",me,[s.status==="pending"?(r(),a("button",{key:0,class:"px-3 py-1 bg-primary-600 text-white rounded-lg text-sm hover:bg-primary-700 transition-colors",onClick:q=>I(s)}," Approve ",8,be)):c("",!0),s.status==="pending"?(r(),a("button",{key:1,class:"px-3 py-1 bg-white border border-rose-200 text-rose-600 rounded-lg text-sm hover:bg-rose-50 transition-colors",onClick:q=>U(s)}," Reject ",8,fe)):c("",!0),J(d,{to:`/partner/orders/${s._id}`,class:"px-3 py-1 border border-slate-200 rounded-lg text-sm hover:bg-slate-50 transition-colors font-bold text-slate-600"},{default:K(()=>[...t[11]||(t[11]=[_(" Details ",-1)])]),_:1},8,["to"])])])])}),128))])]),l.value&&l.value.pages>1?(r(),a("div",ge,[e("span",ye,[t[13]||(t[13]=_(" Showing ",-1)),e("span",he,o(l.value.page*l.value.limit-l.value.limit+1),1),t[14]||(t[14]=_(" to ",-1)),e("span",_e,o(Math.min(l.value.page*l.value.limit,l.value.total)),1),t[15]||(t[15]=_(" of ",-1)),e("span",we,o(l.value.total),1),t[16]||(t[16]=_(" entries ",-1))]),e("div",ke,[e("button",{onClick:t[1]||(t[1]=s=>R(l.value.page-1)),disabled:!l.value.hasPrevPage,class:"px-3 py-1 border border-slate-200 rounded-lg bg-white hover:bg-slate-50 disabled:opacity-50 transition-colors"}," Prev ",8,Ce),e("div",je,[(r(!0),a($,null,z(l.value.pages,s=>(r(),a("button",{key:s,onClick:h=>R(s),class:V(["px-3 py-1 border rounded-lg transition-colors",l.value.page===s?"bg-primary-600 text-white border-primary-600":"bg-white border-slate-200 hover:bg-slate-50"])},o(s),11,Pe))),128))]),e("button",{onClick:t[2]||(t[2]=s=>R(l.value.page+1)),disabled:!l.value.hasNextPage,class:"px-3 py-1 border border-slate-200 rounded-lg bg-white hover:bg-slate-50 disabled:opacity-50 transition-colors"}," Next ",8,Ne)])])):c("",!0)]),f.value?(r(),a("div",Se,[e("div",Ae,[e("div",Ve,[e("h3",Oe,o(u.value==="approve"?"Approve":"Reject")+" Order",1)]),e("div",Te,[C.value?(r(),a("div",Re,o(C.value),1)):c("",!0),x.value?(r(),a("div",$e,o(x.value),1)):c("",!0),e("p",ze,o(u.value==="approve"?"Enter the company approval PIN to confirm this payment.":"Please provide a reason for rejecting this order request."),1),u.value==="approve"&&!j.value?(r(),a("div",Ee,[t[17]||(t[17]=e("label",{class:"text-sm font-medium text-slate-700"},"Approval PIN",-1)),S(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>g.value=s),type:"password",maxlength:"6",placeholder:"••••••",class:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 outline-none text-center text-2xl tracking-widest",autofocus:""},null,512),[[A,g.value]])])):c("",!0),j.value?(r(),a("div",De,[t[18]||(t[18]=e("label",{class:"text-sm font-medium text-slate-700"},"Email Verification Code (OTP)",-1)),S(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>k.value=s),type:"text",maxlength:"6",placeholder:"000000",class:"w-full px-4 py-3 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 outline-none text-center text-2xl tracking-widest font-mono",autofocus:""},null,512),[[A,k.value]]),t[19]||(t[19]=e("p",{class:"text-[10px] text-slate-500 text-center mt-2"},"Enter the 6-digit code sent to your email.",-1))])):c("",!0),e("div",Me,[t[20]||(t[20]=e("label",{class:"text-sm font-medium text-slate-700"},"Internal Notes (Optional)",-1)),S(e("textarea",{"onUpdate:modelValue":t[5]||(t[5]=s=>y.value=s),rows:"3",class:"w-full px-4 py-2 border border-slate-200 rounded-xl focus:ring-2 focus:ring-primary-500 outline-none resize-none",placeholder:"Add any comments here..."},null,512),[[A,y.value]])]),e("div",Be,[e("button",{onClick:t[6]||(t[6]=s=>f.value=!1),class:"flex-1 py-3 border border-slate-200 text-slate-700 font-bold rounded-xl hover:bg-slate-50 transition-colors"}," Cancel "),e("button",{onClick:L,disabled:p.value,class:V(["flex-1 py-3 text-white font-bold rounded-xl transition-all",u.value==="approve"?"bg-primary-600 hover:bg-primary-700":"bg-rose-600 hover:bg-rose-700"])},o(p.value?"Processing...":u.value==="approve"?"Confirm Approval":"Confirm Rejection"),11,Fe)])])])])):c("",!0)])}}});typeof D=="function"&&D(Ie);export{Ie as default};
